const w=[];function G(t){for(const e of t.dependencies)e.delete(t);t.dependencies.clear()}function J(t,e){e.add(t),t.dependencies.add(e)}function D(t){const e=new Set;function r(){const u=w[w.length-1];return u&&J(u,e),t}function l(u){t=u;for(const o of[...e])o.execute()}return[r,l]}function I(t){const e={execute(){G(e),w.push(e),t(),w.pop()},dependencies:new Set};e.execute()}function j(t,e){return t.length===e.length&&t.every((r,l)=>r===e[l])}function A(t,e){t.value=e,t.dispatchEvent(new Event("change"))}function K(t,e){const r=t.lastIndexOf(e);r!==-1&&t.splice(r,1)}function g(t,e){const r=document.createElement(t);return Object.assign(r,e)}function H(t,e){return typeof t=="string"?t.split(e):Array.isArray(t)?t.flatMap(r=>typeof r=="string"?r.split(e):[]):[]}const B="use-bootstrap-tag",F=`${B}-target`;function Q(t){const e=t,r=e.nextElementSibling;r&&r.classList.contains(B)&&r.remove();const l=g("div");e.insertAdjacentElement("afterend",l);const u=e.dataset,o={separator:u.ubTagSeparator||",",variant:u.ubTagVariant||"secondary",xPosition:u.ubTagXPosition||"right",transform:u.ubTagTransform||"input => input",isDuplicate:u.ubTagDuplicate!==void 0,max:+u.ubTagMax>0?+u.ubTagMax:void 0,noInputOnblur:u.ubTagNoInputOnblur!==void 0},m=()=>l.querySelectorAll("button"),O=n=>{n.classList.add("duplicate"),setTimeout(()=>{n.classList.remove("duplicate")},150)},M=()=>e.value,h=()=>M().split(o.separator).filter(n=>n!==""),S=n=>{const s=h(),a=H(n,o.separator);if(!o.max||s.length<o.max){const i=[];!o.isDuplicate&&s.forEach((c,d)=>a.includes(c)&&i.push(d));const p=[];a.forEach(c=>{s.includes(c)?o.isDuplicate&&p.push(c):p.push(c)}),s.push(...p),j(h(),s)||(A(e,s.join(o.separator)),p.forEach(c=>{const d=m()[s.lastIndexOf(c)],z=d.offsetHeight;d.style.height=0,setTimeout(()=>d.style.height=`${z}px`,0),setTimeout(()=>d.style.removeProperty("height"),150)})),o.isDuplicate||i.forEach(c=>O(m()[c]))}else a.length>0&&m().forEach(O)},V=n=>{const s=h();H(n,o.separator).forEach(i=>K(s,i)),j(h(),s)||A(e,s.join(o.separator))},x=e.classList,L=e.disabled;e.tabIndex=-1,x.add(F);const[P,q]=D(e.value),[U,b]=D(!1),[f,T]=D(""),v=()=>P().split(o.separator).filter(n=>n.trim()!==""),C=()=>Function(`return ${o.transform}`)()(f().trim()),$=()=>v().length?"":e.placeholder;l.className=`${B} d-flex flex-wrap align-items-center gap-1 ${x.value}`.replace(F,""),I(()=>{U()?l.classList.add("focus"):l.classList.remove("focus")});const y=()=>{var n;return(n=l.querySelector("input"))==null?void 0:n.focus()},k=n=>{n>=0&&V(v()[n])},N=(n=!1)=>{const s=C();s===""&&T(""),(f().includes(o.separator)||n&&f()!=="")&&(S(s.split(o.separator).filter(a=>a.trim()!=="")),T(""))},E=g("button",{type:"button",className:`align-items-center gap-1 d-inline-flex py-0 border-0 btn btn-${o.variant}`,disabled:L});x.contains("form-control-sm")&&E.classList.add("btn-sm"),x.contains("form-control-lg")&&E.classList.add("btn-lg"),o.xPosition==="left"&&E.classList.add("flex-row-reverse");const X=g("span",{className:"d-inline-flex",role:"button",tabIndex:-1,innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>'}),_=n=>{m().forEach(s=>s.remove()),n.reverse().forEach((s,a)=>{const i=n.length-1-a,p=E.cloneNode();if(p.innerHTML=s,p.onfocus=()=>{p.classList.add("active"),b(!0)},p.onblur=()=>{p.classList.remove("active"),b(!1)},p.onkeydown=({key:c})=>{if(c==="Backspace"||c==="Delete"){k(i);const d=c==="Backspace"?i-1:v().length===i?-1:i;d===-1?y():m()[d].focus()}},!L){const c=X.cloneNode(!0);c.onclick=()=>{k(i),y()},p.append(c)}l.prepend(p)})};if(I(()=>{_(v())}),!L){const n=g("div",{className:"input-wrapper"}),s=g("span"),a=g("input",{type:"text"});a.onfocus=()=>{b(!0)},a.onblur=()=>{b(!1),o.noInputOnblur?T(""):N(!0)},a.onkeydown=i=>{f()===""&&i.key==="Backspace"&&k(v().length-1),f()!==""&&i.key==="Enter"&&(N(!0),i.preventDefault())},a.oninput=()=>{T(a.value),N()},I(()=>{s.innerHTML=f()||$()||"i",a.placeholder=$(),a.value=f()}),n.append(s,a),l.append(n)}return l.onclick=n=>{n.target.tagName!=="BUTTON"&&y()},e.addEventListener("change",()=>{q(e.value)}),e.addEventListener("focus",y),{getValue:M,getValues:h,addValue:S,removeValue:V}}export{Q as default};
